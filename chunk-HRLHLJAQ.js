import{g as F,h as k}from"./chunk-SZTT756B.js";import{a as O,b as q}from"./chunk-RV55OYRA.js";import{g,h as N}from"./chunk-NB62U4HH.js";import"./chunk-TKI237CY.js";import"./chunk-T3Q3DASN.js";import{T as R,W as V}from"./chunk-LGU3LPP7.js";import{a as Q}from"./chunk-HYTDF4VH.js";import"./chunk-4ESSD6YE.js";import"./chunk-LZOT4WJL.js";import{j as T}from"./chunk-PP7QQ7PS.js";import{$ as v,$a as f,Ab as I,Eb as _,Hb as y,Jb as o,Sa as a,Vb as C,Wb as P,Xb as D,eb as S,ga as p,ha as d,jb as x,mc as E,pb as w,ra as h,rb as L,sa as M,ub as u,yb as l,zb as c}from"./chunk-QGFKA7OD.js";function K(i,t){if(i&1){let e=_();l(0,"app-simple-table",1),y("contentChanged",function(n){p(e);let m=o();return d(m.onContentChange(n))}),c()}if(i&2){let e=o();w("displayFilter",!1)("data",e.tableData())("columnDefs",e.columnDefs)}}var b=class i{list=M.required();tableData=f([]);columnDefs=[];filteredList=h();ngOnInit(){let t=new g("sync","Sync","right");t.type="CHECKBOX",t.editable=!0;let e=new g("open","","center");e.type="HTMLELEMENT",this.columnDefs=[new g("name","Name"),new g("modified","Modified"),e,t];let s=this.list().map(n=>{let{iri:m,size:j,modified:z,name:H}=n,r=document.createElement("button");return r.innerText="open",r.style.background="rgba(0,0,0,0)",r.style.border="1px solid",r.style.cursor="pointer",r.style.borderRadius="2px",r.addEventListener("click",()=>{window.open(m,"_blank")}),{id:m,size:j,modified:Q(z),name:H,sync:!0,open:r}});this.tableData.update(()=>[...s])}onContentChange(t){let e=t.filter(n=>n.sync).map(n=>n.id),s=this.list().filter(n=>e.includes(n.iri));this.filteredList.emit(s)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=S({type:i,selectors:[["app-sync-list"]],inputs:{list:[1,"list"]},outputs:{filteredList:"filteredList"},decls:1,vars:1,consts:[[3,"displayFilter","data","columnDefs"],[3,"contentChanged","displayFilter","data","columnDefs"]],template:function(e,s){e&1&&x(0,K,1,3,"app-simple-table",0),e&2&&u(s.tableData().length?0:-1)},dependencies:[N,T],encapsulation:2})};function X(i,t){if(i&1){let e=_();l(0,"button",2),y("click",function(){p(e);let n=o();return d(n.requestList())}),C(1," Sync "),I(2,"mat-icon",3),c()}if(i&2){let e=o();L("pulse",e.syncInProgress())}}function $(i,t){if(i&1){let e=_();l(0,"div",4)(1,"app-sync-list",5),y("filteredList",function(n){p(e);let m=o();return d(m.onFilteredListUpdated(n))}),c()(),C(2),l(3,"button",2),y("click",function(){p(e);let n=o();return d(n.doSync())}),C(4," Confirm "),I(5,"mat-icon",6),c()}if(i&2){let e=o();a(),w("list",e.syncList()),a(),D(" ",e.syncPct()," % "),a(),L("pulse",e.syncInProgress())}}var B=class i{_syncService=v(k);_state=v(F);syncRequest=h();syncInProgress=f(!1);message=f("");syncList=this._syncService.hostList;syncPct=this._syncService.syncPct;_filteredList=[];onSyncListReceived=E(()=>{let t=this.syncList().length;t&&this.message.set(`Received ${t} files from host. Select in the list below which files to sync.`),this.syncInProgress.set(!1),this._filteredList=this.syncList()});requestList(){this.message.set("Requesting host for sync data...");let t=this._state.projectData().lastSync;this.syncRequest.emit({lastSync:t}),this.syncInProgress.set(!0)}async doSync(){this.message.set("Syncing with server"),this.syncInProgress.set(!0),await this._syncService.sync(this._filteredList),this.message.set("Sync was successful"),this.syncInProgress.set(!0)}onFilteredListUpdated(t){this._filteredList=t}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=S({type:i,selectors:[["app-sync"]],outputs:{syncRequest:"syncRequest"},decls:5,vars:3,consts:[[1,"sync-container"],["mat-stroked-button","",3,"pulse"],["mat-stroked-button","",3,"click"],["aria-hidden","false","aria-label","Sync files","fontIcon","sync"],[1,"list"],[3,"filteredList","list"],["aria-hidden","false","aria-label","Confirm sync","fontIcon","sync"]],template:function(e,s){e&1&&(l(0,"div",0)(1,"div"),C(2),c(),x(3,X,3,2,"button",1)(4,$,6,4),c()),e&2&&(a(2),P(s.message()),a(),u(s.syncList().length?-1:3),a(),u(s.syncList().length?4:-1))},dependencies:[V,R,q,O,b],styles:[".sync-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:column;min-height:100%;gap:1rem}.message[_ngcontent-%COMP%]{font-size:.6rem;padding:1rem}.list[_ngcontent-%COMP%]{overflow-y:auto;width:100%}.pulse[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse-animation 2s infinite}@keyframes _ngcontent-%COMP%_pulse-animation{0%{box-shadow:0 0 #0003}to{box-shadow:0 0 0 20px #0000}}"]})};export{B as SyncComponent};
