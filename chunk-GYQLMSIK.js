import{a as R}from"./chunk-QYMGBB35.js";import{a as O,b as q}from"./chunk-KURCRS57.js";import{g,h as N}from"./chunk-GQRBBOHL.js";import"./chunk-ZX22LQFD.js";import"./chunk-T3Q3DASN.js";import{s as k}from"./chunk-J6DBCCXH.js";import{a as B}from"./chunk-3GACR7BN.js";import"./chunk-L63STUKV.js";import"./chunk-W3TA7TL2.js";import{T as V,W as F}from"./chunk-PCC67SUI.js";import{j as I}from"./chunk-EVYDMFX5.js";import{$ as v,Ab as c,Bb as D,Fb as _,Ib as y,Kb as o,Ta as r,Wb as C,Xb as E,Yb as M,ab as f,fb as S,ga as p,ha as d,kb as x,nc as P,qb as b,ra as h,sa as T,sb as L,vb as u,zb as l}from"./chunk-XVNYLTHT.js";function K(i,t){if(i&1){let e=_();l(0,"app-simple-table",1),y("contentChanged",function(n){p(e);let m=o();return d(m.onContentChange(n))}),c()}if(i&2){let e=o();b("displayFilter",!1)("data",e.tableData())("columnDefs",e.columnDefs)}}var w=class i{list=T.required();tableData=f([]);columnDefs=[];filteredList=h();ngOnInit(){let t=new g("sync","Sync","right");t.type="CHECKBOX",t.editable=!0;let e=new g("open","","center");e.type="HTMLELEMENT",this.columnDefs=[new g("name","Name"),new g("modified","Modified"),e,t];let s=this.list().filter(n=>n.outdated).map(n=>{let{iri:m,size:z,modified:Q,name:H}=n,a=document.createElement("button");return a.innerText="open",a.style.background="rgba(0,0,0,0)",a.style.border="1px solid",a.style.cursor="pointer",a.style.borderRadius="2px",a.addEventListener("click",()=>{window.open(m,"_blank")}),{id:m,size:z,modified:B(Q),name:H,sync:!0,open:a}});this.tableData.update(()=>[...s])}onContentChange(t){let e=t.filter(n=>n.sync).map(n=>n.id),s=this.list().filter(n=>e.includes(n.iri));this.filteredList.emit(s)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=S({type:i,selectors:[["app-sync-list"]],inputs:{list:[1,"list"]},outputs:{filteredList:"filteredList"},decls:1,vars:1,consts:[[3,"displayFilter","data","columnDefs"],[3,"contentChanged","displayFilter","data","columnDefs"]],template:function(e,s){e&1&&x(0,K,1,3,"app-simple-table",0),e&2&&u(s.tableData().length?0:-1)},dependencies:[N,I],encapsulation:2})};function X(i,t){if(i&1){let e=_();l(0,"button",2),y("click",function(){p(e);let n=o();return d(n.requestList())}),C(1," Sync "),D(2,"mat-icon",3),c()}if(i&2){let e=o();L("pulse",e.syncInProgress())}}function $(i,t){if(i&1){let e=_();l(0,"div",4)(1,"app-sync-list",5),y("filteredList",function(n){p(e);let m=o();return d(m.onFilteredListUpdated(n))}),c()(),C(2),l(3,"button",2),y("click",function(){p(e);let n=o();return d(n.doSync())}),C(4," Confirm "),D(5,"mat-icon",6),c()}if(i&2){let e=o();r(),b("list",e.syncTable()),r(),M(" ",e.syncPct()," % "),r(),L("pulse",e.syncInProgress())}}var j=class i{_syncService=v(R);_state=v(k);syncRequest=h();syncInProgress=f(!1);message=f("");syncTable=this._syncService.syncTable;syncPct=this._syncService.syncPct;_filteredList=[];onSyncListReceived=P(()=>{let t=this.syncTable().length;t&&this.message.set(`Received ${t} files from host. Select in the list below which files to sync.`),this.syncInProgress.set(!1),this._filteredList=this.syncTable()});requestList(){this.message.set("Requesting host for sync data...");let t=this._state.projectData()?.lastSync;this.syncRequest.emit({lastSync:t}),this.syncInProgress.set(!0)}async doSync(){this.message.set("Syncing with server"),this.syncInProgress.set(!0),await this._syncService.sync(this._filteredList),this.message.set("Sync was successful"),this.syncInProgress.set(!0)}onFilteredListUpdated(t){this._filteredList=t}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=S({type:i,selectors:[["app-sync"]],outputs:{syncRequest:"syncRequest"},decls:5,vars:3,consts:[[1,"sync-container"],["mat-stroked-button","",3,"pulse"],["mat-stroked-button","",3,"click"],["aria-hidden","false","aria-label","Sync files","fontIcon","sync"],[1,"list"],[3,"filteredList","list"],["aria-hidden","false","aria-label","Confirm sync","fontIcon","sync"]],template:function(e,s){e&1&&(l(0,"div",0)(1,"div"),C(2),c(),x(3,X,3,2,"button",1)(4,$,6,4),c()),e&2&&(r(2),E(s.message()),r(),u(s.syncTable().length?-1:3),r(),u(s.syncTable().length?4:-1))},dependencies:[F,V,q,O,w],styles:[".sync-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:column;min-height:100%;gap:1rem}.message[_ngcontent-%COMP%]{font-size:.6rem;padding:1rem}.list[_ngcontent-%COMP%]{overflow-y:auto;width:100%}.pulse[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse-animation 2s infinite}@keyframes _ngcontent-%COMP%_pulse-animation{0%{box-shadow:0 0 #0003}to{box-shadow:0 0 0 20px #0000}}"]})};export{j as SyncComponent};
