import{a as O}from"./chunk-4I4WCNMY.js";import{a as k,b as A}from"./chunk-HIDQVL64.js";import{g as _,h as N}from"./chunk-EFR2NBDC.js";import"./chunk-XX4G4BOT.js";import"./chunk-T3Q3DASN.js";import{R as F,U as V}from"./chunk-IDJ2CURU.js";import{a as w}from"./chunk-37MXYG54.js";import"./chunk-NIQNCP7X.js";import"./chunk-43KZBEMJ.js";import{j as T}from"./chunk-D5SNKE4E.js";import{$ as M,$a as y,Ab as I,Eb as u,Gb as d,Hb as o,Sa as p,Tb as x,Ub as P,eb as g,ga as r,ha as m,jb as h,jc as E,pb as S,ra as C,rb as L,sa as D,ub as f,yb as a,zb as c}from"./chunk-P4UK33DX.js";function U(i,t){if(i&1){let e=u();a(0,"app-simple-table",1),d("contentChanged",function(n){r(e);let l=o();return m(l.onContentChange(n))}),c()}if(i&2){let e=o();S("displayFilter",!1)("data",e.tableData())("columnDefs",e.columnDefs)}}var b=class i{list=D.required();tableData=y([]);columnDefs=[];filteredList=C();ngOnInit(){let t=new _("sync","Sync");t.type="CHECKBOX",t.editable=!0;let e=new _("open","");e.type="HTMLELEMENT",this.columnDefs=[new _("name","Name"),new _("modified","Modified"),e,t];let s=this.list().map(n=>{let{iri:l,size:Q,modified:B,name:z}=n,v=document.createElement("button");return v.innerText="Open",v.addEventListener("click",()=>{window.open(l,"_blank")}),{id:l,size:Q,modified:w(B),name:z,sync:!0,open:v}});console.log(s),this.tableData.update(()=>[...s])}onContentChange(t){let e=t.filter(n=>n.sync).map(n=>n.id),s=this.list().filter(n=>e.includes(n.iri));this.filteredList.emit(s)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=g({type:i,selectors:[["app-sync-list"]],inputs:{list:[1,"list"]},outputs:{filteredList:"filteredList"},decls:1,vars:1,consts:[[3,"displayFilter","data","columnDefs"],[3,"contentChanged","displayFilter","data","columnDefs"]],template:function(e,s){e&1&&h(0,U,1,3,"app-simple-table",0),e&2&&f(s.tableData().length?0:-1)},dependencies:[N,T],encapsulation:2})};function $(i,t){if(i&1){let e=u();a(0,"button",3),d("click",function(){r(e);let n=o();return m(n.initSync())}),x(1," Sync "),I(2,"mat-icon",4),c()}if(i&2){let e=o();L("pulse",e.syncInProgress())}}function q(i,t){if(i&1){let e=u();a(0,"div",5)(1,"app-sync-list",6),d("filteredList",function(n){r(e);let l=o();return m(l.onFilteredListUpdated(n))}),c()(),a(2,"button",3),d("click",function(){r(e);let n=o();return m(n.doSync())}),x(3," Confirm "),I(4,"mat-icon",7),c()}if(i&2){let e=o();p(),S("list",e.syncList()),p(),L("pulse",e.syncInProgress())}}var R=class i{_syncService=M(O);syncAll=C();syncInProgress=y(!1);message=y("");syncList=this._syncService.syncList;onSyncListReceived=E(()=>{let t=this.syncList().length;t&&this.message.set(`Received ${t} files from host. Select in the list below which files to sync.`),this.syncInProgress.set(!1)});initSync(){this.message.set("Getting information on last sync...");let t=this._syncService.getLastSync();this.message.set(`Retrieving new documents since ${w(t)}...`),this.syncAll.emit({lastSync:t}),this.syncInProgress.set(!0)}async doSync(){this.message.set("Syncing with server"),this.syncInProgress.set(!0),await this._syncService.sync(),this.message.set("Sync was successful"),this.syncInProgress.set(!0)}onFilteredListUpdated(t){this._syncService.filteredList=t}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=g({type:i,selectors:[["app-sync"]],outputs:{syncAll:"syncAll"},decls:5,vars:3,consts:[[1,"sync-container"],[1,"message"],["mat-stroked-button","",3,"pulse"],["mat-stroked-button","",3,"click"],["aria-hidden","false","aria-label","Sync files","fontIcon","sync"],[1,"list"],[3,"filteredList","list"],["aria-hidden","false","aria-label","Confirm sync","fontIcon","sync"]],template:function(e,s){e&1&&(a(0,"div",0)(1,"div",1),x(2),c(),h(3,$,3,2,"button",2)(4,q,5,3),c()),e&2&&(p(2),P(s.message()),p(),f(s.syncList().length?-1:3),p(),f(s.syncList().length?4:-1))},dependencies:[V,F,A,k,b],styles:[".sync-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:column;min-height:100%;gap:1rem}.message[_ngcontent-%COMP%]{font-size:.6rem;padding:1rem}.list[_ngcontent-%COMP%]{overflow-y:auto;width:100%}.pulse[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse-animation 2s infinite}@keyframes _ngcontent-%COMP%_pulse-animation{0%{box-shadow:0 0 #0003}to{box-shadow:0 0 0 20px #0000}}"]})};export{R as SyncComponent};
