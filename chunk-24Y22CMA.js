import{a as P,e as O,f as C,g as L,j as N}from"./chunk-2ZP273Z2.js";import{m as T,v as G,x as $}from"./chunk-J24VGB7T.js";import{O as M}from"./chunk-6QX3GPPT.js";import{Q as F,U as m,Va as v,ec as b,fc as x}from"./chunk-Q5IV2UU5.js";import{a as j,d as Z,f as k}from"./chunk-DAQOROHW.js";var J=Z((Q,R)=>{"use strict";(function(f){if(typeof Q=="object")R.exports=f();else if(typeof define=="function"&&define.amd)define(f);else{var a;try{a=window}catch{a=self}a.SparkMD5=f()}})(function(f){"use strict";var a=function(o,i){return o+i&4294967295},s=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function h(o,i,e,t,n,r){return i=a(a(i,o),a(t,r)),a(i<<n|i>>>32-n,e)}function u(o,i){var e=o[0],t=o[1],n=o[2],r=o[3];e+=(t&n|~t&r)+i[0]-680876936|0,e=(e<<7|e>>>25)+t|0,r+=(e&t|~e&n)+i[1]-389564586|0,r=(r<<12|r>>>20)+e|0,n+=(r&e|~r&t)+i[2]+606105819|0,n=(n<<17|n>>>15)+r|0,t+=(n&r|~n&e)+i[3]-1044525330|0,t=(t<<22|t>>>10)+n|0,e+=(t&n|~t&r)+i[4]-176418897|0,e=(e<<7|e>>>25)+t|0,r+=(e&t|~e&n)+i[5]+1200080426|0,r=(r<<12|r>>>20)+e|0,n+=(r&e|~r&t)+i[6]-1473231341|0,n=(n<<17|n>>>15)+r|0,t+=(n&r|~n&e)+i[7]-45705983|0,t=(t<<22|t>>>10)+n|0,e+=(t&n|~t&r)+i[8]+1770035416|0,e=(e<<7|e>>>25)+t|0,r+=(e&t|~e&n)+i[9]-1958414417|0,r=(r<<12|r>>>20)+e|0,n+=(r&e|~r&t)+i[10]-42063|0,n=(n<<17|n>>>15)+r|0,t+=(n&r|~n&e)+i[11]-1990404162|0,t=(t<<22|t>>>10)+n|0,e+=(t&n|~t&r)+i[12]+1804603682|0,e=(e<<7|e>>>25)+t|0,r+=(e&t|~e&n)+i[13]-40341101|0,r=(r<<12|r>>>20)+e|0,n+=(r&e|~r&t)+i[14]-1502002290|0,n=(n<<17|n>>>15)+r|0,t+=(n&r|~n&e)+i[15]+1236535329|0,t=(t<<22|t>>>10)+n|0,e+=(t&r|n&~r)+i[1]-165796510|0,e=(e<<5|e>>>27)+t|0,r+=(e&n|t&~n)+i[6]-1069501632|0,r=(r<<9|r>>>23)+e|0,n+=(r&t|e&~t)+i[11]+643717713|0,n=(n<<14|n>>>18)+r|0,t+=(n&e|r&~e)+i[0]-373897302|0,t=(t<<20|t>>>12)+n|0,e+=(t&r|n&~r)+i[5]-701558691|0,e=(e<<5|e>>>27)+t|0,r+=(e&n|t&~n)+i[10]+38016083|0,r=(r<<9|r>>>23)+e|0,n+=(r&t|e&~t)+i[15]-660478335|0,n=(n<<14|n>>>18)+r|0,t+=(n&e|r&~e)+i[4]-405537848|0,t=(t<<20|t>>>12)+n|0,e+=(t&r|n&~r)+i[9]+568446438|0,e=(e<<5|e>>>27)+t|0,r+=(e&n|t&~n)+i[14]-1019803690|0,r=(r<<9|r>>>23)+e|0,n+=(r&t|e&~t)+i[3]-187363961|0,n=(n<<14|n>>>18)+r|0,t+=(n&e|r&~e)+i[8]+1163531501|0,t=(t<<20|t>>>12)+n|0,e+=(t&r|n&~r)+i[13]-1444681467|0,e=(e<<5|e>>>27)+t|0,r+=(e&n|t&~n)+i[2]-51403784|0,r=(r<<9|r>>>23)+e|0,n+=(r&t|e&~t)+i[7]+1735328473|0,n=(n<<14|n>>>18)+r|0,t+=(n&e|r&~e)+i[12]-1926607734|0,t=(t<<20|t>>>12)+n|0,e+=(t^n^r)+i[5]-378558|0,e=(e<<4|e>>>28)+t|0,r+=(e^t^n)+i[8]-2022574463|0,r=(r<<11|r>>>21)+e|0,n+=(r^e^t)+i[11]+1839030562|0,n=(n<<16|n>>>16)+r|0,t+=(n^r^e)+i[14]-35309556|0,t=(t<<23|t>>>9)+n|0,e+=(t^n^r)+i[1]-1530992060|0,e=(e<<4|e>>>28)+t|0,r+=(e^t^n)+i[4]+1272893353|0,r=(r<<11|r>>>21)+e|0,n+=(r^e^t)+i[7]-155497632|0,n=(n<<16|n>>>16)+r|0,t+=(n^r^e)+i[10]-1094730640|0,t=(t<<23|t>>>9)+n|0,e+=(t^n^r)+i[13]+681279174|0,e=(e<<4|e>>>28)+t|0,r+=(e^t^n)+i[0]-358537222|0,r=(r<<11|r>>>21)+e|0,n+=(r^e^t)+i[3]-722521979|0,n=(n<<16|n>>>16)+r|0,t+=(n^r^e)+i[6]+76029189|0,t=(t<<23|t>>>9)+n|0,e+=(t^n^r)+i[9]-640364487|0,e=(e<<4|e>>>28)+t|0,r+=(e^t^n)+i[12]-421815835|0,r=(r<<11|r>>>21)+e|0,n+=(r^e^t)+i[15]+530742520|0,n=(n<<16|n>>>16)+r|0,t+=(n^r^e)+i[2]-995338651|0,t=(t<<23|t>>>9)+n|0,e+=(n^(t|~r))+i[0]-198630844|0,e=(e<<6|e>>>26)+t|0,r+=(t^(e|~n))+i[7]+1126891415|0,r=(r<<10|r>>>22)+e|0,n+=(e^(r|~t))+i[14]-1416354905|0,n=(n<<15|n>>>17)+r|0,t+=(r^(n|~e))+i[5]-57434055|0,t=(t<<21|t>>>11)+n|0,e+=(n^(t|~r))+i[12]+1700485571|0,e=(e<<6|e>>>26)+t|0,r+=(t^(e|~n))+i[3]-1894986606|0,r=(r<<10|r>>>22)+e|0,n+=(e^(r|~t))+i[10]-1051523|0,n=(n<<15|n>>>17)+r|0,t+=(r^(n|~e))+i[1]-2054922799|0,t=(t<<21|t>>>11)+n|0,e+=(n^(t|~r))+i[8]+1873313359|0,e=(e<<6|e>>>26)+t|0,r+=(t^(e|~n))+i[15]-30611744|0,r=(r<<10|r>>>22)+e|0,n+=(e^(r|~t))+i[6]-1560198380|0,n=(n<<15|n>>>17)+r|0,t+=(r^(n|~e))+i[13]+1309151649|0,t=(t<<21|t>>>11)+n|0,e+=(n^(t|~r))+i[4]-145523070|0,e=(e<<6|e>>>26)+t|0,r+=(t^(e|~n))+i[11]-1120210379|0,r=(r<<10|r>>>22)+e|0,n+=(e^(r|~t))+i[2]+718787259|0,n=(n<<15|n>>>17)+r|0,t+=(r^(n|~e))+i[9]-343485551|0,t=(t<<21|t>>>11)+n|0,o[0]=e+o[0]|0,o[1]=t+o[1]|0,o[2]=n+o[2]|0,o[3]=r+o[3]|0}function y(o){var i=[],e;for(e=0;e<64;e+=4)i[e>>2]=o.charCodeAt(e)+(o.charCodeAt(e+1)<<8)+(o.charCodeAt(e+2)<<16)+(o.charCodeAt(e+3)<<24);return i}function p(o){var i=[],e;for(e=0;e<64;e+=4)i[e>>2]=o[e]+(o[e+1]<<8)+(o[e+2]<<16)+(o[e+3]<<24);return i}function S(o){var i=o.length,e=[1732584193,-271733879,-1732584194,271733878],t,n,r,d,l,g;for(t=64;t<=i;t+=64)u(e,y(o.substring(t-64,t)));for(o=o.substring(t-64),n=o.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)r[t>>2]|=o.charCodeAt(t)<<(t%4<<3);if(r[t>>2]|=128<<(t%4<<3),t>55)for(u(e,r),t=0;t<16;t+=1)r[t]=0;return d=i*8,d=d.toString(16).match(/(.*?)(.{0,8})$/),l=parseInt(d[2],16),g=parseInt(d[1],16)||0,r[14]=l,r[15]=g,u(e,r),e}function w(o){var i=o.length,e=[1732584193,-271733879,-1732584194,271733878],t,n,r,d,l,g;for(t=64;t<=i;t+=64)u(e,p(o.subarray(t-64,t)));for(o=t-64<i?o.subarray(t-64):new Uint8Array(0),n=o.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)r[t>>2]|=o[t]<<(t%4<<3);if(r[t>>2]|=128<<(t%4<<3),t>55)for(u(e,r),t=0;t<16;t+=1)r[t]=0;return d=i*8,d=d.toString(16).match(/(.*?)(.{0,8})$/),l=parseInt(d[2],16),g=parseInt(d[1],16)||0,r[14]=l,r[15]=g,u(e,r),e}function I(o){var i="",e;for(e=0;e<4;e+=1)i+=s[o>>e*8+4&15]+s[o>>e*8&15];return i}function _(o){var i;for(i=0;i<o.length;i+=1)o[i]=I(o[i]);return o.join("")}_(S("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(a=function(o,i){var e=(o&65535)+(i&65535),t=(o>>16)+(i>>16)+(e>>16);return t<<16|e&65535}),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function o(i,e){return i=i|0||0,i<0?Math.max(i+e,0):Math.min(i,e)}ArrayBuffer.prototype.slice=function(i,e){var t=this.byteLength,n=o(i,t),r=t,d,l,g,E;return e!==f&&(r=o(e,t)),n>r?new ArrayBuffer(0):(d=r-n,l=new ArrayBuffer(d),g=new Uint8Array(l),E=new Uint8Array(this,n,d),g.set(E),l)}}();function U(o){return/[\u0080-\uFFFF]/.test(o)&&(o=unescape(encodeURIComponent(o))),o}function V(o,i){var e=o.length,t=new ArrayBuffer(e),n=new Uint8Array(t),r;for(r=0;r<e;r+=1)n[r]=o.charCodeAt(r);return i?n:t}function W(o){return String.fromCharCode.apply(null,new Uint8Array(o))}function X(o,i,e){var t=new Uint8Array(o.byteLength+i.byteLength);return t.set(new Uint8Array(o)),t.set(new Uint8Array(i),o.byteLength),e?t:t.buffer}function A(o){var i=[],e=o.length,t;for(t=0;t<e-1;t+=2)i.push(parseInt(o.substr(t,2),16));return String.fromCharCode.apply(String,i)}function c(){this.reset()}return c.prototype.append=function(o){return this.appendBinary(U(o)),this},c.prototype.appendBinary=function(o){this._buff+=o,this._length+=o.length;var i=this._buff.length,e;for(e=64;e<=i;e+=64)u(this._hash,y(this._buff.substring(e-64,e)));return this._buff=this._buff.substring(e-64),this},c.prototype.end=function(o){var i=this._buff,e=i.length,t,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r;for(t=0;t<e;t+=1)n[t>>2]|=i.charCodeAt(t)<<(t%4<<3);return this._finish(n,e),r=_(this._hash),o&&(r=A(r)),this.reset(),r},c.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},c.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},c.prototype.setState=function(o){return this._buff=o.buff,this._length=o.length,this._hash=o.hash,this},c.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},c.prototype._finish=function(o,i){var e=i,t,n,r;if(o[e>>2]|=128<<(e%4<<3),e>55)for(u(this._hash,o),e=0;e<16;e+=1)o[e]=0;t=this._length*8,t=t.toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(t[2],16),r=parseInt(t[1],16)||0,o[14]=n,o[15]=r,u(this._hash,o)},c.hash=function(o,i){return c.hashBinary(U(o),i)},c.hashBinary=function(o,i){var e=S(o),t=_(e);return i?A(t):t},c.ArrayBuffer=function(){this.reset()},c.ArrayBuffer.prototype.append=function(o){var i=X(this._buff.buffer,o,!0),e=i.length,t;for(this._length+=o.byteLength,t=64;t<=e;t+=64)u(this._hash,p(i.subarray(t-64,t)));return this._buff=t-64<e?new Uint8Array(i.buffer.slice(t-64)):new Uint8Array(0),this},c.ArrayBuffer.prototype.end=function(o){var i=this._buff,e=i.length,t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n,r;for(n=0;n<e;n+=1)t[n>>2]|=i[n]<<(n%4<<3);return this._finish(t,e),r=_(this._hash),o&&(r=A(r)),this.reset(),r},c.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},c.ArrayBuffer.prototype.getState=function(){var o=c.prototype.getState.call(this);return o.buff=W(o.buff),o},c.ArrayBuffer.prototype.setState=function(o){return o.buff=V(o.buff,!0),c.prototype.setState.call(this,o)},c.ArrayBuffer.prototype.destroy=c.prototype.destroy,c.ArrayBuffer.prototype._finish=c.prototype._finish,c.ArrayBuffer.hash=function(o,i){var e=w(new Uint8Array(o)),t=_(e);return i?A(t):t},c})});var z=k(J());async function Y(f){return new Promise(a=>{let s=new z.default.ArrayBuffer;s.append(f);let h=s.end();a(h)})}var q={\u00E4:"ae",a\u0308:"ae",\u00C4:"AE",\u00F6:"oe",\u00D6:"OE",\u00FC:"ue",u\u0308:"ue",\u00DC:"UE",U\u0308:"UE",\u00DF:"ss",\u00E6:"ae",\u00C6:"AE",\u00F8:"oe",\u00D8:"OE",\u00E5:"aa",\u00C5:"AA",\u00E1:"a",\u00C1:"A",\u00F0:"d",\u00D0:"D",\u00E9:"e",\u00C9:"E",\u00ED:"i",\u00CD:"I",\u00F3:"o",\u00D3:"O",\u00FA:"u",\u00DA:"U",\u00FD:"y",\u00DD:"Y",\u00FE:"th",\u00DE:"Th"};function B(f,a=!1){let s="daca0510-72b5-48ba-9091-b918ca18136b";return f=tt(f,a),P(f,s)}function tt(f,a=!1){let s=f;for(let h in q)s=s.replace(new RegExp(h,"g"),q[h]);return a&&s!==f&&console.info(`${f} -> ${s}`),s}function H(f,a=""){return B(`${a}${f}`)}var D=class f{_storage;constructor(){this._storage=$(M())}async uploadData(a,s){let h=await this._getDocumentUUID(a.buffer),u=G(this._storage,`${s.space_id}/${h}${s.suffix}`);await T(u,a,{customMetadata:j({},s)})}async _getDocumentUUID(a){let s=await Y(a);return B(s)}static \u0275fac=function(s){return new(s||f)};static \u0275prov=F({token:f,factory:f.\u0275fac,providedIn:"root"})};var K=class f{_options=m(N);_storage=m(D);_projectRepo=m(C);_auth=m(O);_proj=m(L);_hostList=v([]);hostListEnriched=b(()=>{let a=this._options.options().hostApp;return this._hostList().map(s=>Object.assign({fileUUID:H(s.relativePath,a)},s))});hostSyncObject=b(()=>{if(!this.hostListEnriched().length)return;let a={};return this.hostListEnriched().forEach(s=>{a[s.fileUUID]=s.modified}),a});serverSyncObject=b(()=>this._proj.projectData()?.syncDetails);syncTable=b(()=>{if(this.hostSyncObject()===void 0)return[];let s=this.serverSyncObject()??{};return this.hostListEnriched().map(h=>{let u=s[h.fileUUID],y=u!==void 0,p=!y||new Date(h.modified)>new Date(u);return Object.assign({synced:y,outdated:p,lastSync:u},h)})});_pendingFileSync=x(()=>{let a=this.syncTable();if(!a.length)return!1;let s=a.filter(h=>h.outdated);return s.length===0&&console.info(`Received ${a.length} files from host but all of them were up to date`),s.length>0});_syncPct=v(0);_syncDone=v(!1);get syncPct(){return this._syncPct}get syncDone(){return this._syncDone}set hostList(a){this._hostList.update(()=>[...a])}get hostList(){return this._hostList}get pendingFileSync(){return this._pendingFileSync}dismissPendingFileSync(){this._pendingFileSync.set(!1)}async sync(a){let s=this._proj.projectData();if(!s||s===void 0)throw new Error("Project data is not available");let h=s.id;if(h===void 0)throw new Error('No project id is defined. Please specify using the "pid" attribute');let u=this._auth.user()?.uid;if(u===void 0)throw new Error("User id is not available.");let y=0;for(let p of a){let S=p.name.split(".").pop()??"",w={uploaded_by:u,suffix:`.${S}`,space_id:h,name:p.relativePath,additional_metadata:JSON.stringify({name:p.name,created:p.created,createdBy:p.createdBy,modified:p.modified,modifiedBy:p.modifiedBy})},I=await p.data(p.iri);await this._storage.uploadData(I,w),await this._projectRepo.setFileLastSync(h,p.fileUUID),y++,this._syncPct.set(Math.round(y/a.length*100))}this._syncDone.set(!0),this._pendingFileSync.set(!1),this._hostList.set([])}static \u0275fac=function(s){return new(s||f)};static \u0275prov=F({token:f,factory:f.\u0275fac,providedIn:"root"})};export{K as a};
